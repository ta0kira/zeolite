<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>regex-test.0rt</title>
</head>
<!-- Highlighting: "Zeolite" -->
<body>
<pre style='color:#1f1c1b;background-color:#ffffff;'>
<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchSingle match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;x&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;- <span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'x'</span>)
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should only match once.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should match again after reset.</span>
    matcher &lt;- template.newMatcher()
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchSingle non-match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;x&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;- <span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'x'</span>)
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <span style='color:#0057ae;'>MatchState</span> state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'y'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }

    <span style='color:#898887;'>// Should keep failing to match.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchRange match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;- <span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>)
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should only match once.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should match again after reset.</span>
    matcher &lt;- template.newMatcher()
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchRange non-match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;- <span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>)
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <span style='color:#0057ae;'>MatchState</span> state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }

    <span style='color:#898887;'>// Should keep failing to match.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchAny&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;.&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;- <span style='color:#0057ae;'>MatchAny</span><span style='color:#644a9b;'>$</span>create()
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should only match once.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should match again after reset.</span>
    matcher &lt;- template.newMatcher()
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchEmpty&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;- <span style='color:#0057ae;'>MatchEmpty</span><span style='color:#644a9b;'>$</span>create()
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (!template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;doesn't match empty&quot;</span>)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should match again after reset.</span>
    matcher &lt;- template.newMatcher()
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchRepeat match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]{2,3}&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createRange(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>3</span>,<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'y'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Third character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }

    <span style='color:#898887;'>// Fourth character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Reset to reuse the matcher.</span>
    matcher &lt;- template.newMatcher()

    <span style='color:#898887;'>// Fourth character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'w'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Fifth character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'w'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchRepeat nested&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;(x*){2,}&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createRange(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>0</span>,
            <span style='color:#0057ae;'>MatchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'x'</span>)))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (!template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;doesn't match empty&quot;</span>)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Third character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchRepeat non-match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]{2,3}&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createRange(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>3</span>,<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'q'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should keep failing to match.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchRepeat optional suffix&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;(ab*)*&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(
            <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>),
                        <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                            <span style='color:#0057ae;'>MatchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'b'</span>)),<b>empty</b>)))))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'b'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Third character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchChoices match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]|a*&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchChoices</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>),
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                        <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>))),<b>empty</b>)))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <b>if</b> (!template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;doesn't match empty&quot;</span>)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }

    <span style='color:#898887;'>// Third character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }

    <span style='color:#898887;'>// Reset to reuse the matcher.</span>
    matcher &lt;- template.newMatcher()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchChoices non-match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]|a*&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchChoices</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>),
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                        <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>))),<b>empty</b>)))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (!template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;doesn't match empty&quot;</span>)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }

    <span style='color:#898887;'>// Should keep failing to match.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchChoices empty choice&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]|a{2,2}|&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchChoices</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>),
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                        <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createRange(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>2</span>,<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>))),
                    <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                        <span style='color:#0057ae;'>MatchEmpty</span><span style='color:#644a9b;'>$</span>create(),<b>empty</b>))))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (!template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;doesn't match empty&quot;</span>)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;BranchRepeat match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]{2,3}&quot;</span>
    <span style='color:#0057ae;'>MatchBrancherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createRange(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>3</span>,<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>))
    <span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> brancher &lt;- template.newBrancher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()
    <b>optional</b> <span style='color:#0057ae;'>ReadSequence</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span> branches &lt;- <b>empty</b>

    <span style='color:#898887;'>// First character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    brancher &lt;- <b>require</b>(branches).value()
    <b>if</b> (brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'y'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }
    <b>if</b> (!brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    brancher &lt;- <b>require</b>(branches).value()
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Third character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Reset to reuse the brancher.</span>
    brancher &lt;- template.newBrancher()

    <span style='color:#898887;'>// Fourth character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'w'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;BranchRepeat nested&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;(x*){2,}&quot;</span>
    <span style='color:#0057ae;'>MatchBrancherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createRange(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>0</span>,
            <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'x'</span>))))
    <span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> brancher &lt;- template.newBrancher()

    <b>if</b> (!template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;doesn't match empty&quot;</span>)
    }
    <b>if</b> (!brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()
    <b>optional</b> <span style='color:#0057ae;'>ReadSequence</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span> branches &lt;- <b>empty</b>

    <span style='color:#898887;'>// First character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    brancher &lt;- <b>require</b>(branches).value()
    <b>if</b> (!brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    brancher &lt;- <b>require</b>(branches).value()
    <b>if</b> (!brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
    <span style='color:#898887;'>// Expect one additional branch to continue &quot;xx*&quot;.</span>
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    <span style='color:#898887;'>// Third character, branch 1.</span>
    { state, <b>_</b> } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }

    brancher &lt;- <b>require</b>(branches).value()
    <b>if</b> (!brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
    <span style='color:#898887;'>// No more branches expected.</span>
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Third character, branch 2.</span>
    { state, <b>_</b> } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;BranchRepeat non-match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]{2,3}&quot;</span>
    <span style='color:#0057ae;'>MatchBrancherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createRange(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>3</span>,<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>))
    <span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> brancher &lt;- template.newBrancher()

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()
    <b>optional</b> <span style='color:#0057ae;'>ReadSequence</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span> branches &lt;- <b>empty</b>

    <span style='color:#898887;'>// First character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    brancher &lt;- <b>require</b>(branches).value()
    <b>if</b> (brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'q'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;BranchSequence match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]a&quot;</span>
    <span style='color:#0057ae;'>MatchBrancherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>),
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>),<b>empty</b>)))
    <span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> brancher &lt;- template.newBrancher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()
    <b>optional</b> <span style='color:#0057ae;'>ReadSequence</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span> branches &lt;- <b>empty</b>

    <span style='color:#898887;'>// First character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    brancher &lt;- <b>require</b>(branches).value()
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    <span style='color:#898887;'>// The final branch should just be a record of completeness.</span>
    <b>if</b> (!<b>require</b>(branches).value().matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
    { state, branches } &lt;- <b>require</b>(branches).value().tryBranches(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }

    <span style='color:#898887;'>// Reset to reuse the brancher.</span>
    brancher &lt;- template.newBrancher()

    <span style='color:#898887;'>// Third character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'y'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;BranchSequence non-match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]a&quot;</span>
    <span style='color:#0057ae;'>MatchBrancherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>),
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>),<b>empty</b>)))
    <span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> brancher &lt;- template.newBrancher()

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()
    <b>optional</b> <span style='color:#0057ae;'>ReadSequence</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span> branches &lt;- <b>empty</b>

    <span style='color:#898887;'>// First character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'q'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Should keep failing to match.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;BranchSequence skip empty failed&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;a*b&quot;</span>
    <span style='color:#0057ae;'>MatchBrancherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>))),
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'b'</span>),<b>empty</b>)))
    <span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> brancher &lt;- template.newBrancher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()
    <b>optional</b> <span style='color:#0057ae;'>ReadSequence</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span> branches &lt;- <b>empty</b>

    <span style='color:#898887;'>// First character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'b'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;BranchSequence fail non-empty field&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;a+b&quot;</span>
    <span style='color:#0057ae;'>MatchBrancherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createOnePlus(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>))),
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'b'</span>),<b>empty</b>)))
    <span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> brancher &lt;- template.newBrancher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()
    <b>optional</b> <span style='color:#0057ae;'>ReadSequence</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span> branches &lt;- <b>empty</b>

    <span style='color:#898887;'>// First character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'b'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;BranchSequence branch sequence multi-match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;a*a{0,2}&quot;</span>
    <span style='color:#0057ae;'>MatchBrancherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>))),
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                        <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createRange(<span style='color:#b08000;'>0</span>,<span style='color:#b08000;'>2</span>,<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>))),<b>empty</b>)))
    <span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> brancher &lt;- template.newBrancher()

    <b>if</b> (!template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;doesn't match empty&quot;</span>)
    }
    <b>if</b> (!brancher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()
    <b>optional</b> <span style='color:#0057ae;'>ReadSequence</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatchBrancher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span> branches &lt;- <b>empty</b>

    <span style='color:#898887;'>// First character.</span>
    { state, branches } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    brancher &lt;- <b>require</b>(branches).value()
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (!<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch missing&quot;</span>)
    }

    <span style='color:#898887;'>// TODO: This assumes that the branches are ordered from longest to shortest</span>
    <span style='color:#898887;'>// remaining sequence.</span>

    <span style='color:#898887;'>// Second character, branch 1.</span>
    { state, <b>_</b> } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }

    brancher &lt;- <b>require</b>(branches).value()
    branches &lt;- <b>require</b>(branches).next()
    <b>if</b> (<b>present</b>(branches)) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;branch present&quot;</span>)
    }

    <span style='color:#898887;'>// Second character, branch 2.</span>
    { state, <b>_</b> } &lt;- brancher.tryBranches(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchBranches match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]a&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>),
                    <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>),<b>empty</b>))))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Reset to reuse the matcher.</span>
    matcher &lt;- template.newMatcher()

    <span style='color:#898887;'>// Third character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'y'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchBranches non-match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;[w-y]a&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchRange</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'w</span><span style='color:#924c9d;'>','</span><span style='color:#924c9d;'>y'</span>),
                    <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>),<b>empty</b>))))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (template.matchesEmpty()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;matches empty&quot;</span>)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'x'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'q'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Should keep failing to match.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'y'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail())) {
      <b>fail</b>(state)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchBranches branched match&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;ab&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> templateAB &lt;-
        <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>),
                    <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'b'</span>),<b>empty</b>))))
    <span style='color:#898887;'>// Pattern: &quot;ac&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> templateAC &lt;-
        <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>),
                    <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'c'</span>),<b>empty</b>))))
    <span style='color:#898887;'>// Pattern: &quot;(ab)*ac&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                        <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(templateAB)),
                    <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(templateAC,<b>empty</b>))))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'c'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchComplete())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Reset to reuse the matcher.</span>
    matcher &lt;- template.newMatcher()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'b'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }
  }
}


<b><span style='color:#bf0303;background:#f7e6e6;'>testcase</span></b> <span style='color:#bf0303;'>&quot;MatchBranches partial repeat&quot;</span> {
  <span style='color:#04e040;'>success</span> <span style='color:#0057ae;'>Test</span><span style='color:#644a9b;'>$</span>execute()
}

<b>concrete</b> <b><span style='color:#0057ae;'>Test</span></b> {
  <span style='color:#644a9b;'>@type</span> execute () -&gt; ()
}

<b>define</b> <b><span style='color:#0057ae;'>Test</span></b> {
  execute () {
    <span style='color:#898887;'>// Pattern: &quot;(ab)*&quot;</span>
    <span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> template &lt;-
        <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
            <span style='color:#0057ae;'>BranchRepeat</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>createZeroPlus(
                <span style='color:#0057ae;'>MatchBranches</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                    <span style='color:#0057ae;'>BranchSequence</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(
                        <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'a'</span>),
                            <span style='color:#0057ae;'>LinkedNode</span><span style='color:#c02040;'>&lt;</span><span style='color:#0057ae;'>MatcherTemplate</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#0057ae;'>MatchSingle</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'b'</span>),<b>empty</b>))))))
    <span style='color:#0057ae;'>Matcher</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Char</span></i><span style='color:#c02040;'>&gt;</span> matcher &lt;- template.newMatcher()

    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }

    <span style='color:#0057ae;'>MatchState</span> state &lt;- <span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchFail()

    <span style='color:#898887;'>// First character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'a'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match satisfied&quot;</span>)
    }

    <span style='color:#898887;'>// Second character.</span>
    state &lt;- matcher.tryNextMatch(<span style='color:#924c9d;'>'b'</span>)
    <b>if</b> (!<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>equals(state,<span style='color:#0057ae;'>MatchState</span><span style='color:#644a9b;'>$</span>matchContinue())) {
      <b>fail</b>(state)
    }
    <b>if</b> (!matcher.matchSatisfied()) {
      <b>fail</b>(<span style='color:#bf0303;'>&quot;match not satisfied&quot;</span>)
    }
  }
}
</pre>
</body>
</html>
