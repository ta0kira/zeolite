@value interface Writer<#x|> {
  write (#x) -> ()
}

@value interface BufferedWriter<#x|> {
  refines Writer<#x>

  flush () -> ()
}

concrete LazyStream<#x> {
  @type new () -> (LazyStream<#x>)
  @value append (#x) -> (LazyStream<#x>)
  @value writeTo (BufferedWriter<#x>) -> ()
}

concrete SimpleOutput {
  refines BufferedWriter<Formatted>

  @type stdout () -> (SimpleOutput)
  @type stderr () -> (SimpleOutput)
  @type fail () -> (SimpleOutput)
}

@type interface Runner {
  run () -> ()
}
