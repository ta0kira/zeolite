<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>test-data.0rx</title>
</head>
<!-- Highlighting: "Zeolite" -->
<body>
<pre style='color:#1f1c1b;background-color:#ffffff;'>
<b><i><span style='color:#8060c0;'>$TestsOnly$</span></i></b>

<b>define</b> <b><span style='color:#0057ae;'>TestData</span></b> {
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><b>any</b><span style='color:#c02040;'>&gt;</span>    whitespace &lt;- <span style='color:#0057ae;'>SequenceOfParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot; </span><span style='color:#924c9d;'>\n\t</span><span style='color:#bf0303;'>&quot;</span>,<span style='color:#b08000;'>1</span>,<span style='color:#b08000;'>0</span>)

  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span> sentence        &lt;- <span style='color:#0057ae;'>SentenceParser</span><span style='color:#644a9b;'>$</span>create()
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span> token           &lt;- <span style='color:#0057ae;'>SequenceOfParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ_&quot;</span>,<span style='color:#b08000;'>1</span>,<span style='color:#b08000;'>0</span>)
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span> sentenceOrToken &lt;- sentence <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>or&lt;<i><span style='color:#0057ae;'>String</span></i>&gt;<b><span style='color:#c02040;'>`</span></b> token <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>left&lt;<i><span style='color:#0057ae;'>String</span></i>&gt;<b><span style='color:#c02040;'>`</span></b> whitespace

  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Bool</span></i><span style='color:#c02040;'>&gt;</span>   acronym           &lt;- <span style='color:#0057ae;'>StringParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot;acronym&quot;</span>)  <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>right&lt;<i><span style='color:#0057ae;'>Bool</span></i>&gt;<b><span style='color:#c02040;'>`</span></b> <span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>const&lt;<i><span style='color:#0057ae;'>Bool</span></i>&gt;(<b>true</b>)
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Bool</span></i><span style='color:#c02040;'>&gt;</span>   aardvark          &lt;- <span style='color:#0057ae;'>StringParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot;aardvark&quot;</span>) <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>right&lt;<i><span style='color:#0057ae;'>Bool</span></i>&gt;<b><span style='color:#c02040;'>`</span></b> <span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>const&lt;<i><span style='color:#0057ae;'>Bool</span></i>&gt;(<b>false</b>)
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Bool</span></i><span style='color:#c02040;'>&gt;</span>   acronymOrAardvark &lt;- <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>try&lt;<i><span style='color:#0057ae;'>Bool</span></i>&gt;<b><span style='color:#c02040;'>`</span></b> acronym <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>or&lt;<i><span style='color:#0057ae;'>Bool</span></i>&gt;<b><span style='color:#c02040;'>`</span></b> aardvark <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>left&lt;<i><span style='color:#0057ae;'>Bool</span></i>&gt;<b><span style='color:#c02040;'>`</span></b> whitespace

  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><b>any</b><span style='color:#c02040;'>&gt;</span>    fileStart      &lt;- <span style='color:#0057ae;'>StringParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot;file_start&quot;</span>)   <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>left&lt;<b>any</b>&gt;<b><span style='color:#c02040;'>`</span></b> whitespace
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><b>any</b><span style='color:#c02040;'>&gt;</span>    fileEnd        &lt;- <span style='color:#0057ae;'>StringParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot;file_end&quot;</span>)     <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>left&lt;<b>any</b>&gt;<b><span style='color:#c02040;'>`</span></b> whitespace
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><b>any</b><span style='color:#c02040;'>&gt;</span>    nameTag        &lt;- <span style='color:#0057ae;'>StringParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot;name:&quot;</span>)        <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>left&lt;<b>any</b>&gt;<b><span style='color:#c02040;'>`</span></b> whitespace
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><b>any</b><span style='color:#c02040;'>&gt;</span>    descriptionTag &lt;- <span style='color:#0057ae;'>StringParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot;description:&quot;</span>) <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>left&lt;<b>any</b>&gt;<b><span style='color:#c02040;'>`</span></b> whitespace
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><b>any</b><span style='color:#c02040;'>&gt;</span>    aWordTag       &lt;- <span style='color:#0057ae;'>StringParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#bf0303;'>&quot;a_word:&quot;</span>)      <b><span style='color:#c02040;'>`</span></b><span style='color:#0057ae;'>Parse</span><span style='color:#644a9b;'>$</span>left&lt;<b>any</b>&gt;<b><span style='color:#c02040;'>`</span></b> whitespace

  <span style='color:#644a9b;'>@value</span> <i><span style='color:#0057ae;'>String</span></i> name
  <span style='color:#644a9b;'>@value</span> <i><span style='color:#0057ae;'>String</span></i> description
  <span style='color:#644a9b;'>@value</span> <i><span style='color:#0057ae;'>Bool</span></i>   boolean

  parseFrom (data) {
    <span style='color:#0057ae;'>ParseState</span><span style='color:#c02040;'>&lt;</span><b>any</b><span style='color:#c02040;'>&gt;</span> state &lt;- <span style='color:#0057ae;'>ParseState</span><span style='color:#644a9b;'>$$</span>new(data)
    state                              &lt;- state.run&lt;<b>any</b>&gt;(fileStart)
    state                              &lt;- state.run&lt;<b>any</b>&gt;(nameTag)
    state, <span style='color:#0057ae;'>ErrorOr</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span> name        &lt;- state.runAndGet&lt;<i><span style='color:#0057ae;'>String</span></i>&gt;(sentenceOrToken)
    state                              &lt;- state.run&lt;<b>any</b>&gt;(descriptionTag)
    state, <span style='color:#0057ae;'>ErrorOr</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span> description &lt;- state.runAndGet&lt;<i><span style='color:#0057ae;'>String</span></i>&gt;(sentenceOrToken)
    state                              &lt;- state.run&lt;<b>any</b>&gt;(aWordTag)
    state, <span style='color:#0057ae;'>ErrorOr</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>Bool</span></i><span style='color:#c02040;'>&gt;</span> boolean       &lt;- state.runAndGet&lt;<i><span style='color:#0057ae;'>Bool</span></i>&gt;(acronymOrAardvark)
    state                              &lt;- state.run&lt;<b>any</b>&gt;(fileEnd)

    <b>if</b> (state.hasAnyError()) {
      <b>return</b> <span style='color:#0057ae;'>ErrorOr</span><span style='color:#644a9b;'>$$</span>error(state.getError())
    } <b>elif</b> (!state.atEof()) {
      <b>return</b> <span style='color:#0057ae;'>ErrorOr</span><span style='color:#644a9b;'>$$</span>error(<span style='color:#bf0303;'>&quot;Parsing did not consume all of the data&quot;</span>)
    } <b>else</b> {
      <b>return</b> <span style='color:#0057ae;'>ErrorOr</span><span style='color:#644a9b;'>$$</span>value&lt;<span style='color:#0057ae;'>TestData</span>&gt;(<span style='color:#0057ae;'>TestData</span>{ name.getValue(),
                                                description.getValue(),
                                                boolean.getValue() })
    }
  }

  getName () {
    <b>return</b> name
  }

  getDescription () {
    <b>return</b> description
  }

  getBoolean () {
    <b>return</b> boolean
  }
}

<b>concrete</b> <b><span style='color:#0057ae;'>SentenceParser</span></b> {
  <span style='color:#644a9b;'>@type</span> create () -&gt; (<span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span>)
}

<b>define</b> <b><span style='color:#0057ae;'>SentenceParser</span></b> {
  <b>refines</b> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span>

  <span style='color:#644a9b;'>@category</span> <i><span style='color:#0057ae;'>String</span></i> sentenceChars &lt;- <span style='color:#bf0303;'>&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span> +
                                    <span style='color:#bf0303;'>&quot;abcdefghijklmnopqrstuvwxyz&quot;</span> +
                                    <span style='color:#bf0303;'>&quot;., !?-&quot;</span>
  <span style='color:#644a9b;'>@category</span> <span style='color:#0057ae;'>Parser</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span> string &lt;- <span style='color:#0057ae;'>SequenceOfParser</span><span style='color:#644a9b;'>$</span>create(sentenceChars,<span style='color:#b08000;'>0</span>,<span style='color:#b08000;'>0</span>)

  run (contextOld) {
    <b>if</b> (contextOld.hasAnyError()) {
      <b>return</b> contextOld.convertError&lt;<i><span style='color:#0057ae;'>String</span></i>&gt;()
    }
    <span style='color:#0057ae;'>ParseContext</span><span style='color:#c02040;'>&lt;</span><b>any</b><span style='color:#c02040;'>&gt;</span> context &lt;- contextOld
    context                       &lt;- context.run&lt;<b>any</b>&gt;(<span style='color:#0057ae;'>CharParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'&quot;'</span>))
    context, <span style='color:#0057ae;'>ErrorOr</span><span style='color:#c02040;'>&lt;</span><i><span style='color:#0057ae;'>String</span></i><span style='color:#c02040;'>&gt;</span> text &lt;- context.runAndGet&lt;<i><span style='color:#0057ae;'>String</span></i>&gt;(string)
    context                       &lt;- context.run&lt;<b>any</b>&gt;(<span style='color:#0057ae;'>CharParser</span><span style='color:#644a9b;'>$</span>create(<span style='color:#924c9d;'>'&quot;'</span>))
    <b>return</b> context.setValue&lt;<i><span style='color:#0057ae;'>String</span></i>&gt;(text)
  }

  create () {
    <b>return</b> <span style='color:#0057ae;'>SentenceParser</span>{ }
  }
}
</pre>
</body>
</html>
