define LazyStream {
  @value optional #x value
  @value optional LazyStream<#x> next

  new () {
    return LazyStream<#x>{ empty, empty }
  }

  append (value2) {
    return LazyStream<#x>{ value2, self }
  }

  @value recursive (Writer<#x>) -> ()
  recursive (writer) {
    if (present(next)) {
      ~ require(next).recursive(writer)
    }
    if (present(value)) {
      ~ writer.write(require(value))
    }
  }

  writeTo (writer) {
    ~ recursive(writer)
    ~ writer.flush()
  }
}
