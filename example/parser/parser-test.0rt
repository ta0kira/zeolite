testcase "parser sequence" {
  success Test$execute()
}

concrete Test {
  @type execute () -> ()
}

define Test {
  execute () {
    TestData data <- TestData$parseFrom(loadTestData()).getValue()

    if (data.getName() != "example data") {
      fail(data.getName())
    }
    if (data.getDescription() != "THIS_IS_A_TOKEN") {
      fail(data.getDescription())
    }
  }

  @type loadTestData () -> (String)
  loadTestData () {
    scoped {
      RawFileReader reader <- RawFileReader$open($ExprLookup[MODULE_PATH]$ + "/test-data.txt")
    } cleanup {
      \ reader.freeResource()
    } in return TextReader$readAll(reader)
  }
}
